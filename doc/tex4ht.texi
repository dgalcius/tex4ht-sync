\input texinfo
@c $Id$
@setfilename tex4ht.info
@settitle Extrapolating @TeX{}4ht

@copying
This manual is for @TeX{}4ht.

Copyright 2009, 2010 @TeX{} Users Group.

@c quotation
This work may be distributed and/or modified under the
conditions of the @LaTeX{} Project Public License, either
version@tie{}1.3c of this license or (at your option) any
later version. The latest version of this license is in
  @url{http://www.latex-project.org/lppl.txt}
and version@tie{}1.3c or later is part of all distributions
of @LaTeX{} version 2005/12/01 or later.

This work has the LPPL maintenance status ``maintained''.

The Current Maintainer of this work
is the @TeX{}4ht Project@* (@url{http://tug.org/tex4ht}).
@c end quotation
@end copying

@dircategory TeX
@direntry
* TeX4ht: (tex4ht).             Extrapolating TeX4ht internals.
@end direntry

@titlepage
@title Extrapolating @TeX{}4ht
@subtitle @url{http://tug.org/tex4ht}
@author @TeX{}4ht Project
@page
@vskip 0pt plus 1filll
@insertcopying
@end titlepage

@contents

@ifnottex
@node Top
@top Extrapolating @TeX{}4ht

@insertcopying

@end ifnottex

@menu
* Introduction::
* Implementation::
* Literate sources::
@end menu

@node Introduction
@chapter Introduction

@TeX{}4ht is a @TeX{} package created and developed by
Eitan@tie{}M. Gurari, who was Associate Professor of Computer Science
at Ohio State University until his premature death on June@tie{}22,
2009.  Our continuing work on his software is dedicated to his memory.

@TeX{}4ht translates documents written in @TeX{} or any of its common
variants (@LaTeX{}, Con@TeX{}t, etc.)@ into other markup formats, such
as HTML, XML, SGML, etc., optionally using MathML or other formats,
with nearly endless possibilities for customization.  The home page of
the project is @url{http://tug.org/tex4ht}.  The software is released
under the @LaTeX{} Project Public License, version 1.3 or later.

The present document is currently focused on maintenance of @TeX{}4ht
itself, which includes hundreds of @TeX{} packages, hypertext fonts, C
and Java programs, DTDs, usually all wrapped in a (homegrown) literate
programming style.  For user documentation, please see the resources
on the home page.  Perhaps this manual will be more extensive one day.

@TeX{}4ht is currently maintained by CV Radhkrishnan and Karl Berry
(the ``@TeX{}4ht Project''); we would be very grateful for additional
volunteers.  The development site, mailing lists, etc., are also
linked from @url{http://tug.org/tex4ht}.


@node Implementation
@chapter Implementation: How @TeX{}4ht works

@TeX{}4ht has a three-step approach to the translation process:

@menu
* Preprocessing with ht*::
* Processing with tex4ht::
* Post-processing::
@end menu

@node Preprocessing with ht*
@section Preprocessing with @code{ht*} to DVI

@code{foo.tex} is processed with the appropriate script (@code{htex},
@code{htlatex}, @code{htcontext}, @code{...}) which will load
@code{tex4ht.sty} and other relevant packages to create @code{foo.dvi}
by calling the @code{tex} compiler with appropriate format. @TeX{}4ht
adopts a different pattern of package loading. It loads
@code{tex4ht.sty} at the beginning of the document, stops after a
while, then allows loading all the packages which the author wants
with @code{\usepackage} function.  Once it reaches the
@code{\begin@{document@}} hook, which means that all extra package
loading has been completed, @code{tex4ht} loads itself for the second
time. This time, since it has the information about all additional
packages loaded, it will call the relevant @code{.4ht} macro packages
to assist the main @code{tex4ht.sty}.

For instance, if the author has used @code{biblatex.sty},
@code{tex4ht} will call @code{biblatex.4ht} or if @code{amsmath.sty}
was used, @code{amsmath.4ht} will be input, and so on.  Eitan wrote a
@code{*.4ht} for nearly all of the most often used @LaTeX{}
packages.

Then the source @code{foo.tex} is processed in the usual manner to
create @code{foo.dvi}.  With @TeX{}4ht, we always need @code{.dvi}
output since @code{.pdf} output is not useful for conversion. This is
the first stage in the translation process.


@node Processing with tex4ht
@section Processing with @code{tex4ht}

The second stage is to call the @code{tex4ht} binary to post-process
@code{foo.dvi}. This is the real meat of the process where ASCII
characters of element and attribute names, attribute values, etc.,
which are output in @code{\special}s in the @code{.dvi}, are
extracted. Also, it does the substitution of characters in textual
strings in the typeset version.

As you may be aware, the @code{.dvi} file has font and position
information of all characters of all strings in the document. Suppose
the @code{.dvi} has a character @math{\gamma}. When rendered to a
particular media, the character is taken from the 13th position of the
font by name, @code{cmmi}.  When extracting text from the @code{.dvi},
instead of taking the glyph from @code{cmmi.pfb}, @code{tex4ht} takes
the character from the 13th position in the corresponding hypertext
font, @code{cmmi.htf} (@code{htf} denoting hypertext font, multitudes
of which were again created by Eitan).

A @dfn{hypertext font} is an ASCII file, created by hand in a text
editor, with each line defining a character of the font.  The first
line corresponds to character code 0, the second to character code 1,
etc.  In @code{cmmi.htf} for example, the first 13 lines look
something like this:

@verbatim
cmmi 0 127
'&#x0393;' ''  Gamma     0 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
'&#x0394;' ''  Delta     1 % cmmi.htf (unicode)            2003-03-27 %
'&#x0398;' ''  Theta     2 % Copyright (C) 2000--2003 Michel Goossens %
'&#x039B;' ''  Lambda    3 %                          Eitan M. Gurari %
'&#x039E;' ''  Xi        4 %                                          % 
'&#x03A0;' ''  Pi        5 % This file can redistributed and/or       % 
'&#x03A3;' ''  Sigma     6 % modified under the terms of the LaTeX    % 
'&#x03A5;' ''  Upsilon   7 % Project Public License Distributed from  % 
'&#x03A6;' ''  Phi       8 % CTAN archives in directory               % 
'&#x03A8;' ''  Psi       9 % macros/latex/base/lppl.txt; either       % 
'&#x03A9;' ''  Omega    10 % version 1 of the License, or (at your    % 
'&#x03B1;' ''  alpha    11 % option) any later version.               % 
'&#x03B2;' ''  beta     12 %    However, you are allowed to modify    % 
'&#x03B3;' ''  gamma    13 % this file without changing its name, if  % 
...
@end verbatim

The character code given in the 13th position of @code{cmmi.htf} is
@code{&#x03B3;}, which is the Unicode entity for lower case gamma
(@math{\gamma}). @code{tex4ht} will happily substitute this code in
place of the typeset gamma character in the @code{dvi} during
post-processing the @code{.dvi}.  Hence, the converted document will
have appropriate entities (or whatever we want) in place of the
@TeX{}-font-specific @code{.dvi} references.  You can add prefixes or
suffixes to the entities or character codes. eg.,
@code{<mi>&#x03B3;</mi>} (MathML code for @math{\gamma}).

@node Post-processing
@section Post-processing

The third and final stage is to post-process the translated
document further which may involve:

@itemize 
@item parse the document with appropriate parser.

@item create @code{.png} or other images of math formulae
and equations, if requested (for the sake of browsers which do not
support MathML).

@item write out @code{.css} files for proper rendering in a
browser.

@item perform system dependent tasks like copying to target
directories or @code{ftp} to different destinations, etc.

@item During post-processing, one can output the translated document
as several chunks, such as one file for each section, instead of
having a single long document.  We use this feature to write out many
files to overcome various I/O limitations of @TeX{}.

@end itemize


@node Literate sources
@chapter Literate sources

Following are the literate source files which comprise @TeX{}4ht.
Some modifications to specific files are described below.  We have
globally updated the license information.

Specific processing instructions are provided as remarks at the top of
each source file.  All packages, C and Java sources, fonts, DTD's,
etc., are generated from the literate sources by running @TeX{},
@LaTeX{} or any of the many @TeX{}4ht scripts such as @code{ht},
@code{htlatex}, @enddots{}

@menu
* tex4ht-4ht.tex::
* tex4ht-cpright.tex::
* tex4ht-dir.tex::
* tex4ht-fonts-4ht.tex::
* tex4ht-mkht.tex::
@end menu

@enumerate
@item @code{tex4ht-4ht.tex}
@item @code{tex4ht-auto-script.tex}
@item @code{tex4ht-bibtex2.tex}
@item @code{tex4ht-c.tex}
@item @code{tex4ht-cond4ht.tex}
@item @code{tex4ht-cpright.tex}
@item @code{tex4ht-dir.tex}
@item @code{tex4ht-docbook-xtpipes.tex}
@item @code{tex4ht-docbook.tex}
@item @code{tex4ht-env.tex}
@item @code{tex4ht-fonts-4hf.tex}
@item @code{tex4ht-fonts-cjk-utf8.tex}
@item @code{tex4ht-fonts-cjk.tex}
@item @code{tex4ht-fonts-modern.tex}
@item @code{tex4ht-fonts-noncjk.tex}
@item @code{tex4ht-htcmd.tex}
@item @code{tex4ht-html-speech-xtpipes.tex}
@item @code{tex4ht-html-speech.tex}
@item @code{tex4ht-html0.tex}
@item @code{tex4ht-html32.tex}
@item @code{tex4ht-html4.tex}
@item @code{tex4ht-info-html4.tex}
@item @code{tex4ht-info-javahelp.tex}
@item @code{tex4ht-info-mml.tex}
@item @code{tex4ht-info-ooffice.tex}
@item @code{tex4ht-info-svg.tex}
@item @code{tex4ht-info.tex}
@item @code{tex4ht-javahelp-xtpipes.tex}
@item @code{tex4ht-javahelp.tex}
@item @code{tex4ht-jsmath.tex}
@item @code{tex4ht-jsml-xtpipes.tex}
@item @code{tex4ht-jsml.tex}
@item @code{tex4ht-mathltx.tex}
@item @code{tex4ht-mathml.tex}
@item @code{tex4ht-mathplayer.tex}
@item @code{tex4ht-mkht.tex}
@item @code{tex4ht-moz.tex}
@item @code{tex4ht-oo-xtpipes.tex}
@item @code{tex4ht-ooffice.tex}
@item @code{tex4ht-ooimpress.tex}
@item @code{tex4ht-options.tex}
@item @code{tex4ht-sty.tex}
@item @code{tex4ht-svg.tex}
@item @code{tex4ht-t4ht.tex}
@item @code{tex4ht-tei.tex}
@item @code{tex4ht-unicode.tex}
@item @code{tex4ht-word.tex}
@item @code{tex4ht-xhtml-xtpipes.tex}
@item @code{tex4ht-xhtmml-xtpipes.tex}
@item @code{xtpipes.tex}
@end enumerate

@node tex4ht-4ht.tex
@section @code{tex4ht-4ht.tex}

This is the (extremely large) literate source for all the @code{.4ht}
files in the @TeX{}4ht bundle.  Run the following command to generate
all @code{.4ht} files:

@verbatim
ht tex tex4ht-4ht
@end verbatim

Nicholas Cole posted a bug report on the @code{texhax} mailing list
regarding an undefined control sequence error of
@verb{|\blx@resetpuncthook|} and @verb{|\blx@csq@ifkernmark|}.  The
reason was that these macros were not initialized.  So, we added the
following lines at the beginning of @code{\<config biblatex\>}:

@verbatim
\let\blx@resetpuncthook\@empty
\let\blx@csq@ifkernmark\@empty
@end verbatim

Christoph Haug reported that @verb{|\bib@field@entrykey|} creates an
undefined control sequence error if @code{\printbibliography} is
invoked.  Another of with uninitialized macros, solved by adding:

@verbatim
\let\bib@field@keyentry\@empty
@end verbatim

Also, Christoph said that there were a few spurious spaces after the
opening parenthesis of year in an author-year citation and few other
places.  All were fixed.


@node tex4ht-cpright.tex
@section @code{tex4ht-cpright.tex}

The standard copyright statement was changed to the following:

@verbatim
\<TeX4ht copyright\><<<
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either
% version 1.3c of this license or (at your option) any
% later version. The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3c or later is part of all distributions
% of LaTeX version 2005/12/01 or later.
%
% This work has the LPPL maintenance status "maintained".
%
% The Current Maintainer of this work
% is the TeX4ht Project <http://tug.org/tex4ht>.
% 
% If you modify this program, changing the 
% version identification would be appreciated.
>>>
@end verbatim

Filename, author name and date are inserted at the top of this
statement.


@node tex4ht-dir.tex
@section @code{tex4ht-dir.tex}

Defines the path of your @code{tex4ht} package files.  The default
provided by Eitan was:
@verbatim
\def\HOME{/home/4/gurari/tex4ht.dir/}
\def\DTDS{/home/4/gurari/dtd.dir/}           
@end verbatim

We switched these to use @file{.} instead of his hardcoded path.


@node tex4ht-fonts-4ht.tex
@section @code{tex4ht-fonts-4ht.tex}

This file generates all the @code{*.4hf}---hypertext font files---of
the @TeX{}4ht bundle.  The file has 101806 lines! We had to increase
@TeX{}'s memory and make new format for \latex to run this file. Here
are the new values:
@table @code
@item strings=494909
@item pool_size=1180334 @r{(string characters)}
@item main_memory=7999999 @r{(words of memory)}
@item multiletter control sequences=15000+50000
@end table

Also, these needed values are the default in @TeX{} Live 2009:
@table @code
@item font_mem_size=3000000 @r{(words of font info)}
@item hyph_size=8191 @r{(hyphenation exceptions)}
@end table


@node tex4ht-mkht.tex
@section @code{tex4ht-mkht.tex}

CVR made significant changes on September 13, 2009:

@itemize

@item All the backslash characters in the path names (conventional directory
Separators under Windows) have been changed to forward slash.  This is
per the suggestion of Akira Kakuto, primary Windows developer for
@TeX{} Live.

@item @code{\version} has been redefined.

@item New functions, @code{\ScriptFileName} and @code{\AddExtn} have
been defined to add file names of the script at the top of each script
or batch file.  These were not provided in the versions written by
Eitan, but now needed for best license practices.

@item @code{\AddExtn} will add @code{.bat} if and only if the script
is a batch file.

@item A new function @code{\<Mycopyrightnotice\>} has been defined to
add the usual copyright information (@pxref{tex4ht-cpright.tex}) to
each script when written out.

@item The @code{\Rem} macro used in @code{\<Mycopyrightnotice\>}
expands to the @code{#} character in Unix scripts and @code{Rem} in
Windows batch files.

@end itemize

@bye
