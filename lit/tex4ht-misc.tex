% http://www.tug.org/texlive/Contents/live/texmf-dist/doc/xetex/XeTeX-notes.pdf

% tex tex4ht-misc   or   ht tex tex4ht-misc
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% tex4ht-misc.tex                                       
% Copyright (C) 2012 TeX Users Group
%                                                       
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either
% version 1.3c of this license or (at your option) any  
% later version. The latest version of this license is  
% in                                                    
%   http://www.latex-project.org/lppl.txt               
% and version 1.3c or later is part of all distributions
% of LaTeX version 2005/12/01 or later.                 
%                                                       
% This work has the LPPL maintenance status "maintained"
%                                                       
% This Current Maintainer of this work                  
% is TeX4ht Projecct Team.                              
%                                                       
% If you modify this file your changing the signature   
% in \message{(signature)} below will be appreciated.   
%                                                       
%                                        tex4ht@tug.org 
%                             http://www.tug.org/tex4ht 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   
\message{(<signature>)}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   
\input DraTex.sty
\input AlDraTex.sty

\DrawOff

\immediate\write16{----------Verify length of lines!!!!------------}
\immediate\write16{----------Verify length of lines!!!!------------}
\immediate\write16{----------Verify length of lines!!!!------------}
\immediate\write16{----------Verify length of lines!!!!------------}

\newif\ifalprotex \alprotexfalse

\hbadness=10000     \vbadness=10000  \hfuzz=99in \vfuzz=99in
\def\BREAK{^^J}

\def\Link#1\EndLink{}

\openin15=th4.4ht
          \ifeof15

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% replacement for TeX4ht %%%%%%%%%%%%%%%%%%
\csname newif\endcsname\ifHtml \Htmlfalse
\def\-#1{\ifx#1-\expandafter\TEMP\else\expandafter#1\fi}
\expandafter\let\csname bye\endcsname=\end
\def\TEMP#1/#2/#3/{}
\def\HTable#1{}
\def\'#1'{}
\def\`#1'{}
\let\TableOfContents=\relax
\def\Part#1{}
\def\Chapter#1{}
\def\Appendix#1{}
\def\Section#1{}
\def\SubSection#1{}
\def\Margin#1{}
\def\HCode#1{}
\def\LinkPort\<#1\>{}
\def\TagSec#1{}
\def\RefSec#1{}
\def\List#1{}   \let\ShortList=\List
\def\EndList{}
\def\item{}
\def\IgnorePar{} 
\def\EndP{}
\catcode`\:=11
\csname newcount\endcsname\tmp:cnt
          \def\no:catcodes#1#2#3{%
   \tmp:cnt=#1
   \def\no::catcodes{%
      \catcode\tmp:cnt=#3
      \ifnum\tmp:cnt<#2
          \advance\tmp:cnt by 1  \expandafter\no::catcodes
      \fi }%
   \no::catcodes }
           \let\:oldlq=\`
\let\:oldrq=\'
\def\'{\leavevmode \:cats  \::cats}
\def\::cats#1{\if  #1"\expandafter\:oldrq
              \else  \def\:eat##1#1{\tt ##1\egroup}\expandafter\:eat\fi}
\def\`{\leavevmode \:cats  \:::cats}
\def\:::cats#1{\if #1"\expandafter\:oldlq
               \else \def\:eat##1#1{`{\tt ##1}'\egroup}\expandafter\:eat\fi}
\def\:cats{\bgroup  \no:catcodes0{255}{12}\catcode`\ = 10
           \catcode`\^^M = 10 \catcode`\^^I = 10
}

\def\HPage{}  \def\EndHPage{}
\def\Verbatim{\bgroup\catcode`\\=12 \catcode`\#=12
   \catcode`\^=12 \catcode`\_=12
   \catcode`\{=12 \catcode`\}=12 \catcode`\%=12 \:vrb}
\long\def\:vrb#1EndVerbatim{\egroup}


   \closein15 
       \def\next{%\input DraTex.sty
                 \input ProTex.sty
             \AlProTex{sty,<<<>>>,|,title,list,[],ClearCode}}
   \catcode`\:=12
\else 
   \closein15 
      \def\next{%\input DraTex.sty
                \input tex4ht.sty
                \Preamble{html,th4,family,sections+,xhtml,next}
                \Configure{@HEAD}{\HCode{<link rev="made" 
%                      href="mailto:gurari@cse.ohio-state.edu" />}}
                      href="mailto:tex4ht@tug.org" />}}
%                \input MyTeX4ht.sty {}%
                \input ProTex.sty
             \AlProTex{sty,<<<>>>,|,title,list,[],ClearCode}
                \EndPreamble
       }
\fi



\next

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\expandafter \ifx \csname append:def\endcsname \relax
   \expandafter\def\csname append:def\endcsname#1#2{%
      \def\Xtemp{\def#1}%
      \expandafter\expandafter\expandafter\Xtemp\expandafter{#1#2}}
\fi

\expandafter \ifx \csname Verbatim\endcsname \relax
   \def\Verbatim{\bgroup 
      \catcode`\^=10 \catcode`\\=10  \catcode`\%=10
       \catcode`\{=10    \catcode`\}=10    \catcode`\#=10     \catcode`\#=10
       \XVerbatim}
   \long\def\XVerbatim#1EndVerbatim{\egroup}
\fi

\expandafter \ifx \csname Verb\endcsname \relax
    \def\Verb{\bgroup \catcode`\^=10 \catcode`\\=10  \catcode`\%=10
       \catcode`\{=10    \catcode`\}=10    \catcode`\#=10     \catcode`\#=10
       \leavevmode \Xctgs}
    \def\Xctgs#1{\def\Xeat##1#1{\egroup}\Xeat }
\fi

\ifx \HAssign\UnDef

\csname newcount\endcsname \tmpXxXcnt

\def\advXxX#1{\def\XxXvar{#1}\futurelet\XxXtemp\AdvancXxX}
\def\AdvancXxX{\ifx [\XxXtemp \expandafter\AdvancXxXe
              \else \expandXxXafter{\expandafter\advXxXc\XxXvar}\fi}
\def\AdvancXxXe[#1]{\expandafter\advXxXc\csname
                  \expandafter\string\XxXvar[#1]\endcsname}

\def\gXxXAdvance#1{\bgroup \def\XxXtemp{#1}%
                 \tmpXxXcnt#1\afterassignment\XxXgplus \mthXxXop\tmpXxXcnt}
\def\XxXgplus{\expandafter\xdef\XxXtemp{\the\tmpXxXcnt}\egroup}
\def\XxXAdvance#1{\bgroup \def\XxXtemp{#1}%
                \tmpXxXcnt#1\afterassignment\XxXaplus \mthXxXop\tmpXxXcnt}
\def\XxXaplus{\xdef\XxXtemp{\def\expandafter\noexpand\XxXtemp{\the\tmpXxXcnt}}%
            \egroup \XxXtemp}
\def\HAssign{\XxXssg\edef}
\def\gHAssign{\XxXssg\xdef}

\def\XxXssg#1#2{\let\dXxXfn#1\def\XxXvar{#2}\futurelet\XxXtemp\XxXAssgn}
\def\XxXAssgn{%
   \ifx [\XxXtemp
         \expandafter\dXxXfn\XxXvar[##1]{%
              \noexpand\csname  \expandafter
                                  \string\XxXvar[##1]\noexpand\endcsname}%
         \expandafter\assgXxXm
   \else \afterassignment\assgXxXv \expandafter \tmpXxXcnt \fi }

\def\assgXxXv{\expandafter\dXxXfn\XxXvar{\the\tmpXxXcnt}}
\def\assgXxXm[#1]{%
   \def\XxXtemp{\expandafter\dXxXfn
      \csname \expandafter\string\XxXvar[#1]\endcsname{\the\tmpXxXcnt}}%
   \afterassignment\XxXtemp  \tmpXxXcnt}

\fi
\catcode`\:=11
\csname newcount\endcsname\tmp:cnt
\expandafter\ifx \csname no:catcodes\endcsname\relax
   \def\no:catcodes#1#2#3{%
      \tmp:cnt=#1
      \def\no::catcodes{%
         \catcode\tmp:cnt=#3
         \ifnum\tmp:cnt<#2
             \advance\tmp:cnt by 1  \expandafter\no::catcodes
         \fi }%
      \no::catcodes }
\fi
\let\:oldlq=\`
\let\:oldrq=\'
\def\'{\leavevmode \:cats  \::cats}
\def\::cats#1{\if  #1"\expandafter\:oldrq
              \else  \def\:eat##1#1{\tt ##1\egroup}\expandafter\:eat\fi}
\def\`{\leavevmode \:cats  \:::cats}
\def\:::cats#1{\if #1"\expandafter\:oldlq
               \else \def\:eat##1#1{`{\tt ##1}'\egroup}\expandafter\:eat\fi}
\bgroup
  \catcode`\^=7
  \gdef\:cats{\bgroup  \no:catcodes0{255}{12}\catcode`\ = 10
           \catcode`\^^M = 10 \catcode`\^^I = 10
  }
\egroup
\catcode`\:=12
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\HOME{/opt/cvr/gurari/tex4ht.dir/texmf/tex/generic/tex4ht/}
\def\SOURCE{/opt/cvr/gurari/main.dir/html.dir}

\newcount\tmpcnt  \tmpcnt\time  \divide\tmpcnt  60
\edef\temp{\the\tmpcnt}
\multiply\tmpcnt  -60 \advance\tmpcnt  \time

\edef\version{\the\year-\ifnum \month<10 0\fi
  \the\month-\ifnum \day<10 0\fi\the\day
   -\ifnum \temp<10 0\fi \temp
   :\ifnum \tmpcnt<10 0\fi\the\tmpcnt}

\def\CopyYear.#1.{%
   \ifnum #1=\year #1\space\space\space\space\space\space
    \else          #1--2009\fi
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\let\ConfigFiles=\empty
\def\AddFile#1#2{\csname append:def\endcsname\ConfigFiles{\AddFile{#1}{#2}}}

\AddFile{0}{Preamble}
\AddFile{0}{tex4ht}
\AddFile{0}{tex4ht2}
\AddFile{0}{etex4ht}

\let\OutFiles=\empty
\def\AddFile{\futurelet\next\contAddFile}
\def\contAddFile{%
   \ifx [\next \def\next{\finishAddFile}%
   \else       \def\next{\finishAddFile[]}\fi
   \bgroup \catcode`\_=12 \next
}
\def\finishAddFile[#1]#2#3{\egroup
   \immediate\write16{ ==> <#1, #2, #3>}%
   \csname append:def\endcsname\OutFiles{\OutputCodE\<\if !#1!#3\else #1\fi.4ht\>}%
   \csname append:def\endcsname\ConfigFiles{\AddFile{#2}{#3}}%
}


\ifHtml

\def\tocSubSection#1#2#3{\par| #2}  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                                    % must appear before all TocAt
                                    % that refer to SubSection
                                    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TocAt{Part,Chapter,Section,LikeSection}
\TocAt{Chapter,Section,LikeSection,/Appendix,/Part}
\TocAt{LikeChapter,Section,LikeSection,/Appendix,/Part}
\TocAt{Appendix,Section,LikeSection,/Appendix,/Part}
\TocAt{Section,SubSection,/LikeSection}
\TocAt{LikeSection,SubSection,/Section}

\CutAt{Part}
\CutAt{Chapter,LikeChapter,Appendix,Part}
\CutAt{LikeChapter,Chapter,Appendix,Part}
\CutAt{Appendix,Chapter,LikeChapter,Part}
\CutAt{Section,LikeSection,Appendix,Chapter,LikeChapter,Part}
\CutAt{LikeSection,Section,Appendix,Chapter,LikeChapter,Part}
\CutAt{SubSection,Section,LikeSection,Appendix,Chapter,LikeChapter,Part}

\else
\def\ParentOf#1{}
\csname TableOfContents\endcsname
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\by{by}\def\={=}
\let\pReModifyOutputCode=\ModifyOutputCode
\def\ModifyOutputCode{%
   \def\by{}\def\={}%
   \pReModifyOutputCode}

\csname NoOutputCode\endcsname

\let\coDE=\<
\def\<{\vfil\par\coDE}

\tracingstats=1
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\IgnorePar\EndP \HCode{<h1>A `Literate' View of tex4ht-misc.tex</h1>}


\csname TableOfContents\endcsname[ParentOf,Part,Chapter,%
                         Appendix,LikeChapter%,Section,LikeSection%
     ]



%%%%%%%%%%%%%%%%%%%%%
\Part{Deeper Toc}
%%%%%%%%%%%%%%%%%%

\csname TableOfContents\endcsname[ParentOf,Part,Chapter,%
                         Appendix,LikeChapter,Section,LikeSection%
     ]

%----------------- shared with TeX4ht ------------------------------------

%%%%%%%%%%%%%%%%%%%%%
\Part{Shared}
%%%%%%%%%%%%%%%%%%


\<par del\><<<
!*?: >>>


\<section html addr\><<<
|<toc tag|>1-\file:id-\TitleCount >>>

\<toc tag\><<<
Q>>>

%------------------------------ start here ------------------------

\Chapter{Outline of the Miscellaneous Code}

All the new configurations and code for *.4ht packages will go below
this. 

\<TeX4ht copyright\><<<
% Copyright (c) |the|year  TeX Users Group 
%                                                        
% This work may be distributed and/or modified under the 
% conditions of the LaTeX Project Public License, either 
% version 1.3c of this license or (at your option) any   
% later version. The latest version of this license is   
% in                                                     
%   http://www.latex-project.org/lppl.txt                
% and version 1.3c or later is part of all distributions 
% of LaTeX version 2005/12/01 or later.                  
%                                                        
% This work has the LPPL maintenance status "maintained".
%                                                        
% This Current Maintainer of this work                   
% is the TeX4ht Project <tex4ht@tug.org>.                
%                                                        
% If you modify this program your changing its signature 
% with a directive of the following form will be         
% appreciated.                                           
%            \message{signature}                         
%                                                        
%                                        tex4ht@tug.org  
%                             http://www.tug.org/tex4ht  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\immediate\write-1{version |version}
>>>


\<lettrine.4ht\><<<
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% lettrine.4ht                             |version %
|<TeX4ht copyright|>
|<config lettrine|>
\Hinput{lettrine}
\endinput
>>>                        \AddFile{2}{lettrine}


\<config lettrine\><<<
\NewConfigure{lettrine}{7}
\define@key{LH}{ante}{\def\LH:ante{#1}}%
\define@key{LH}{findent}{\def\LH:findent{#1}}%
\define@key{LH}{lhang}{\def\LH:lhang{#1}}%
\define@key{LH}{lines}{\def\LH:lines{#1}}%
\def\reset:LH:keys{\let\LH:ante\@empty
    \def\LH:lines{2}%
    \def\LH:lhang{0}%
    \def\LH:findent{0pt}}
\reset:LH:keys
%
\def\@lettrine[#1]#2#3{\setkeys{LH}{#1}%
     \H:lettrine:Char{#2}%
     \def\HlettrineString{#3}%
     \a:lettrine
     \ifx\LH:ante\@empty\else\f:lettrine\LH:ante\g:lettrine\fi
     \c:lettrine
      \HCode{<span class="letter-}#2\HCode{">}#2\HCode{</span>}
     \b:lettrine\d:lettrine#3\e:lettrine
     \reset:LH:keys}
%
% a: before lettrine
% b: after lettrine
% c: before letter
% d: between letter and string
% e: after string
% f: before ante
% g: after ante
%
\Configure{lettrine}
   {\HCode{<span class="lettrine">}}
   {\HCode{</span>}}
%
   {\HCode{<span class="lettrine-letter">}}
   {\HCode{</span><span class="lettrine-line">}}
   {\HCode{</span>}}
%
   {\HCode{<span class="lettrine-ante">}}
   {\HCode{</span>}}
%
% Define default Css
%
\Css{.lettrine{float: left;
    line-height: 0.7; margin-left: -0.1em;
    margin-bottom: -1em; margin-right: 0.2em;
    }}
\Css{.lettrine-ante{vertical-align: top;}}
\Css{.lettrine-letter{font-style: normal;
    font-size: 4em; color: gray;}}
%
\Css{.lettrine-A{margin-right: 0.3em;}}
\Css{.lettrine-A + .lettrine-line{margin-left: -0.4em;}}
\Css{.lettrine-\unexpanded{À}{margin-right: 0.3em;}}
\Css{.lettrine-\unexpanded{À} + .lettrine-line{margin-left: -0.4em;}}
\Css{.lettrine-J{line-height: 1; margin-right: 0;}}
\Css{.lettrine-H, .lettrine-I, .lettrine-N, .lettrine-U{margin-right: 0;}}
\Css{.lettrine-V{margin-right: -0.3em;}}
\Css{.lettrine-V + .lettrine-line{margin-left: 0.3em;}}
\Css{.lettrine-Q{padding-bottom: 1em;margin-top: -0.6em;}}
\Css{.lettrine-line{font-variant: small-caps;}}>>>                 


\AddFile{9}{mktex4ht}


\Part{The Template mktex4ht.4ht}

\bgroup
\immediate\openout15=mktex4ht.cnf
\def\AddFile#1#2{\immediate\write15{\string\AddFile{#1}{#2}}}
\ConfigFiles
\immediate\closeout15
\egroup

\openin15=th4.4ht
\ifeof15 
   \<mktex4ht.4ht\><<<
   \write16{**********************************}
   \write16{*** recompile 'tex tex4ht-misc' ***}
   \write16{**********************************}
   >>>
   \OutFiles
   \write16{****************************************************}
   \write16{*** compile the file again with 'tex tex4ht-misc' ***}
   \write16{****************************************************}
   \csname bye\endcsname
\fi

\input cond4ht.4ht


%-------------------------------------------------------
\let\OPO=\OutputCodE
\def\OutputCodE\<#1\>{%
   \openin15=\HOME/#1
%   \ifeof15    \Needs{"ln -s #1 \HOME/#1"} 
    \ifeof15    \Needs{"cp -f #1 \HOME#1"} 
        \immediate\write16{"cd \HOME; ln -s \SOURCE/#1 . ; cd \SOURCE"} \fi
   \closein15
   \OPO\<#1\>}

\OutFiles

\bye
